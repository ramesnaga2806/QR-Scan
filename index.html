<!DOCTYPE html>
<html>
<head>
    <title>OCR Scanner with Zoom + Filters + Excel Export</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        video {
            width: 100%;
            max-height: 380px;
            object-fit: cover;
            border: 2px solid black;
            border-radius: 10px;
        }
        canvas { display: none; }
        #resultBox {
            margin-top: 20px;
            font-size: 22px;
            font-weight: bold;
            padding: 10px;
            border: 2px solid green;
            border-radius: 10px;
        }
        .controls {
            margin-top: 15px;
        }
    </style>
</head>

<body>

<h2>OCR Scanner â€“ Zoom + Filter + Excel Export</h2>

<video id="camera" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<div class="controls">
    <label>Zoom: </label>
    <input type="range" id="zoomSlider" min="1" max="4" step="0.1" value="1">

    <br><br>

    <label>Brightness:</label>
    <input type="range" id="brightnessSlider" min="50" max="200" value="100">
    <br>

    <label>Contrast:</label>
    <input type="range" id="contrastSlider" min="50" max="200" value="100">
</div>

<br>

<button id="scanBtn">Scan Text</button>
<button id="downloadExcel">Download Excel</button>

<div id="resultBox">Detected: (empty)</div>

<script>
    const video = document.getElementById("camera");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const resultBox = document.getElementById("resultBox");

    let detectedValues = [];

    // Improved camera quality
    navigator.mediaDevices.getUserMedia({
        video: {
            facingMode: "environment",
            width: { ideal: 1920 },
            height: { ideal: 1080 }
        }
    }).then(stream => {
        video.srcObject = stream;
    });

    function applyFilters() {
        let brightness = document.getElementById("brightnessSlider").value;
        let contrast = document.getElementById("contrastSlider").value;

        video.style.filter = `brightness(${brightness}%) contrast(${contrast}%)`;
    }

    document.getElementById("brightnessSlider").oninput = applyFilters;
    document.getElementById("contrastSlider").oninput = applyFilters;

    document.getElementById("scanBtn").onclick = async function () {
        let zoom = document.getElementById("zoomSlider").value;

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        ctx.drawImage(
            video,
            canvas.width / 2 - (canvas.width / (2 * zoom)),
            canvas.height / 2 - (canvas.height / (2 * zoom)),
            canvas.width / zoom,
            canvas.height / zoom,
            0,
            0,
            canvas.width,
            canvas.height
        );

        const dataURL = canvas.toDataURL("image/png");

        const result = await Tesseract.recognize(dataURL, 'eng', {
            tessedit_char_whitelist: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',
        });

        let text = result.data.text.replace(/[^A-Z0-9]/g, "").trim();

        resultBox.innerHTML = "Detected: " + text;

        if (text.length > 0) {
            detectedValues.push(text);
        }
    };

    document.getElementById("downloadExcel").onclick = function () {
        let wb = XLSX.utils.book_new();
        let ws = XLSX.utils.aoa_to_sheet([["Detected Numbers"], ...detectedValues.map(v => [v])]);
        XLSX.utils.book_append_sheet(wb, ws, "Data");
        XLSX.writeFile(wb, "scanned_data.xlsx");
    }
</script>

</body>
</html>
