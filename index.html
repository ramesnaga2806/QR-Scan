<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sticker Number Scanner</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
<style>
  video {
    width: 100%;
    transform: scale(1.8); /* zoom video */
  }
  #result {
    font-size: 30px;
    font-weight: bold;
    color: green;
    margin-top: 10px;
  }
</style>
</head>
<body>

<h3>Scan Sticker Number</h3>
<button onclick="startCamera()">Open Camera</button>
<button onclick="capture()">Capture & Detect</button>

<br><br>
<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<div id="result"></div>

<script>
let stream;

async function startCamera() {
  stream = await navigator.mediaDevices.getUserMedia({
    video: {
      facingMode: "environment",
      zoom: 4   // strong zoom (max supported by phone)
    }
  });
  document.getElementById("video").srcObject = stream;

  // Try to set maximum zoom if device supports it
  const [track] = stream.getVideoTracks();
  const capabilities = track.getCapabilities();
  if (capabilities.zoom) {
    track.applyConstraints({ advanced: [{ zoom: capabilities.zoom.max }] });
  }
}

async function capture() {
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  // Take photo
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

  // OCR
  const text = await Tesseract.recognize(canvas, "eng");

  // Extract ONLY sticker number (e.g., 077347722EA)
  const match = text.data.text.match(/[0-9]{9}[A-Z]{2}/);

  if (match) {
    document.getElementById("result").innerText = "Detected: " + match[0];
  } else {
    document.getElementById("result").innerText = "Number not clear â€” try closer";
  }
}
</script>

</body>
</html>
